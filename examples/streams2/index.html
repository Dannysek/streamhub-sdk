<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" type="text/css" href="/src/views/css/list-view.css">
    <link rel="stylesheet" type="text/css" href="/src/content/css/content.css">
    <style>
    #listView {
        width:500px;
    }
    </style>
    <script type="text/javascript" src="//platform.twitter.com/widgets.js"></script>
</head>
    <body>
        <div id="listView"></div>
        <a class="show-more">Add 50</a>

        <script src="../../lib/requirejs/require.js" type="text/javascript"></script>
        <script src="/requirejs.conf.js" type="text/javascript"></script>
        <script>
        require([
            'jquery',
            'streamhub-sdk',
            'streamhub-sdk/views/list-view',
            'streamhub-sdk/streams/collection-archive',
            'streamhub-sdk/streams/livefyre-stream',
            'stream/writable',
            'inherits'
        ],function ($, Hub, ListView, CollectionArchive, LivefyreStream, Writable, inherits) {
            var $el = $('#listView');
            var view = window.view = new ListView({
                el: $el[0]
            });

            var opts = {
                "network": "labs-t402.fyre.co",
                "siteId": "303827",
                "articleId": "labs_demo_fire",
                "environment": "t402.livefyre.com"
            };
            
            var bss = new CollectionArchive(opts);

            bss.on('readable', function () {
                console.log('bss readable');
            });
            bss.on('error', function (err) {
                console.log('bss error', err);
            });
            bss.on('end', function (err) {
                console.log('bss end');
            });
            window.bss = bss


            function WritableView (view, initialCount) {
                this._itemCountGoal = initialCount;
                this._view = view;
                Writable.call(this, {});
            };
            inherits(WritableView, Writable);

            WritableView.prototype._write = function (content, requestMore) {
                var self = this;
                console.log("WritableView._write", content);
                if ( ! this._itemCountGoal) {
                    this._requestMoreWrites = requestMore;
                    return;
                }
                this._view.add(content);
                this._itemCountGoal--;
                requestMore();
            }

            WritableView.prototype.showMore = function (numToShow) {
                var requestMoreWrites = this._requestMoreWrites;
                this._itemCountGoal += numToShow;
                if (typeof requestMoreWrites === 'function') {
                    this._requestMoreWrites = null;
                    requestMoreWrites();
                }
            }

            var writableView = window.wV = new WritableView(view, 10);
            window.showMore = function (n) {
                writableView.showMore(n);
            }


            bss.pipe(writableView);


            // SHOW MORE BUTTON

            $('.show-more').on('click', function () {
                writableView.showMore(50);
            });

        });
        </script>
    </body>
</html>
